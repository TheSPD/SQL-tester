<dom-module id="plot-page">
	<style is="custom-style" include="iron-flex">

		.flexchild {
			@apply(--layout-flex);
		}

		.heading{
			color: var(--secondary-text-color);
		}

		.style-scope.plot-page{
			-webkit-margin-before: 0.25em;
			-webkit-margin-after: 0.25em;
		}

		.plotContent {
			@apply(--layout);
			background-color: #ddd;
			position: relative;
			width: 266px;
			height: 200px;
			margin: 8px;
			overflow: hidden;
			box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);	
		}

		.plotContent:hover .detail{
			opacity: 1;
		}

		.plotContent > iron-image{
			-webkit-transform: scale(1);
			transform: scale(1);
			-webkit-transition: 1s ease-in-out;
			transition: 1s ease-in-out;

			width: 100%;
			height:100%;
			--iron-image-width: 100%;
			--iron-image-height: 100%;
		}
		
		.plotContent > iron-image:hover {
			-webkit-transform: scale(1.1);
			transform: scale(1.05);
		}

		.plotContent > iron-image {
			@apply(--layout-flex);
			margin: 0;
			cursor: pointer;
		}

		.plotContent > .detail {
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%);
			color: white;
			font-size: 20px;
			font-weight: 100;
			padding: 20px;
			opacity: 0;
			transition: opacity 0.1s;
			margin: 0;
		}

		@media (max-width: 800px) {
			.plotContainer {
				width: calc(50% - 16px);
			}

			.plotContent {
				width: auto;
			}
		}

		@media (max-width: 400px) {
			iron-list {
				margin-top: 72px;
			}

			.plotContainer {
				width: 100%;
			}

			.plotContent > .detail {
				opacity: 1;
			}
		}

		iron-image {
			margin: 0;
		}
	</style>
	<template>
		<div class="flexchild" id="container">
			<template is="dom-if" if="[[info]]" id="logged">
				<button-panel datasets="[[datasets]]"
								data="[[data]]"
								method="[[method]]"
								data-id="[[dataId]]"
								info="[[info]]">
				</button-panel>
			</template>
			
			<template is="dom-repeat" items="[[data]]" as="data">
				<div>
					<h2 class="heading">
						[[data._id.dataset.heading]]
					</h2>
				</div>
				<iron-list items="[[data.plots]]" as="plot" grid selectionEnabled>
					<template>
						<div class="plotContainer">
							<div class="plotContent" tabindex$="[[tabIndex]]" on-click="_openPlotDisplay" dataid = "[[data._id.dataset._id]]">
								<iron-image src="/api/plot/[[plot.plot]]">
								</iron-image>
								<div class="detail">[[plot.xAxis]] vs. [[plot.yAxis]]</div>
							</div>
						</div>
					</template>
				</iron-list>
			</template>

			<plot-display	id="plotDisplay" info="[[info]]" plot-id="[[selectedPlotId]]" data-id="[[selectedDataId]]">
			</plot-display>
		</div>
	</template>
</dom-module>
<script type="text/javascript">
	Polymer({
		is: "plot-page",

		properties: {
			dataId:{
				type: String,
			},
			method:{
				type:String,
			},
			data:{
				type: Array,
			},
			info:{
				type: Object,
			},
			datasets:{
				type: Array,
			},
			selectedPlotId: {
				type: String,
			},
			selectedDataId: {
				type: String,
			}
		},

		openOverlay: function(event){
			debugger;
			event.currentTarget.parentElement.children[1].open();
		},

		_uploadPlot: function(){
			debugger;
			this.$.dialog.open();
		},

		_openPlotDisplay: function(event){
			debugger;
			this.set('selectedDataId',event.currentTarget.dataid);
			this.set('selectedPlotId',event.model.plot._id);
			this.$.plotDisplay.open();
		}

	})
</script> 	